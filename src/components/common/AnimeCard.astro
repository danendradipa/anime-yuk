---
import type { Anime } from '../../types/anime';

interface Props {
  anime: Anime;
  loading?: 'lazy' | 'eager';
}

const { anime, loading = 'lazy' } = Astro.props;

const imageUrl = anime.images.webp.large_image_url || anime.images.jpg.large_image_url;
const title = anime.title_english || anime.title;
---

<article class="group relative flex h-full flex-col overflow-hidden rounded-xl border border-gray-200 bg-white transition-all duration-300 hover:-translate-y-1 hover:border-blue-500 hover:shadow-md dark:border-gray-800 dark:bg-gray-900 dark:hover:border-blue-400">
  <a href={`/anime/${anime.mal_id}`} class="flex h-full flex-col">
    
    <div class="relative aspect-3/4 overflow-hidden bg-gray-100 dark:bg-gray-800">
      <img
        src={imageUrl}
        alt={title}
        loading={loading}
        class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
      />
      
      {anime.score && (
        <div class="absolute right-2 top-2 flex items-center gap-1 rounded-md border border-gray-200/50 bg-white/90 px-2 py-1 text-xs font-bold text-gray-900 backdrop-blur-sm dark:border-gray-700/50 dark:bg-gray-950/90 dark:text-white">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-yellow-500" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
          </svg>
          {anime.score.toFixed(1)}
        </div>
      )}

      {anime.airing && (
        <div class="absolute left-2 top-2 rounded-md bg-green-500/90 px-2 py-1 text-[10px] font-bold uppercase tracking-wider text-white backdrop-blur-sm dark:bg-green-600/90">
          Airing
        </div>
      )}
    </div>

    <div class="flex flex-1 flex-col p-4">
      <h3 class="mb-2 line-clamp-2 text-base font-bold leading-snug text-gray-900 transition-colors group-hover:text-blue-600 dark:text-gray-100 dark:group-hover:text-blue-400">
        {title}
      </h3>
      
      <div class="mb-3 flex items-center gap-2 text-xs font-medium text-gray-500 dark:text-gray-400">
        {anime.type && (
          <span class="rounded bg-gray-100 px-1.5 py-0.5 dark:bg-gray-800">
            {anime.type}
          </span>
        )}
        {anime.episodes && (
          <>
            <span>â€¢</span>
            <span>{anime.episodes} eps</span>
          </>
        )}
      </div>

      {anime.synopsis && (
        <p class="mb-4 line-clamp-3 text-sm leading-relaxed text-gray-600 dark:text-gray-400">
          {anime.synopsis}
        </p>
      )}

      <div class="mt-auto flex flex-wrap gap-1.5">
        {anime.genres?.slice(0, 3).map((genre) => (
          <span class="rounded-md bg-gray-100 px-2 py-1 text-[10px] font-medium text-gray-600 dark:bg-gray-800 dark:text-gray-300">
            {genre.name}
          </span>
        ))}
      </div>
    </div>
  </a>
</article>