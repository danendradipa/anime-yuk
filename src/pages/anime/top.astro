---
export const prerender = false;
import Layout from '../../layouts/Layout.astro';
import AnimeList from '../../components/common/AnimeList.astro';
import Pagination from '../../components/react/Pagination';
import { getTopAnime } from '../../api/animeApi';

const page = parseInt(Astro.url.searchParams.get('page') || '1');

let topAnimeResponse;
let errorMessage = '';

try {
  topAnimeResponse = await getTopAnime(page, 25);
} catch (error) {
  console.error('Error fetching top anime:', error);
  errorMessage = 'Gagal memuat data anime. Silakan coba lagi.';
}
---

<Layout 
  title="Top Anime - AnimeYuk"
  description="Discover the highest-rated and most popular anime series of all time"
>
  <div class="mb-8">
    <h1 class="text-4xl md:text-5xl font-bold mb-4">
      <span class="text-white">
        üèÜ Top Anime
      </span>
    </h1>
    <p class="text-gray-400 text-lg">
      Anime dengan rating tertinggi sepanjang masa
    </p>
  </div>

  {errorMessage ? (
    <div class="bg-red-900/20 border border-red-500 rounded-lg p-6 text-center">
      <p class="text-red-400">{errorMessage}</p>
    </div>
  ) : topAnimeResponse && (
    <>
      <AnimeList animes={topAnimeResponse.data} />
      
      {topAnimeResponse.pagination && (
        <Pagination
          client:only="react"
          currentPage={topAnimeResponse.pagination.current_page}
          lastPage={topAnimeResponse.pagination.last_visible_page}
          hasNextPage={topAnimeResponse.pagination.has_next_page}
          baseUrl="/anime/top"
        />
      )}
    </>
  )}
</Layout>