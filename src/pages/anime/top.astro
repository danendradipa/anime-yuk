---
export const prerender = false;
import Layout from '../../layouts/Layout.astro';
import AnimeList from '../../components/common/AnimeList.astro';
import Pagination from '../../components/react/Pagination';
import { getTopAnime } from '../../api/animeApi';

const page = parseInt(Astro.url.searchParams.get('page') || '1');

let topAnimeResponse;
let errorMessage = '';

try {
  topAnimeResponse = await getTopAnime(page, 25);
} catch (error) {
  console.error('Error fetching top anime:', error);
  errorMessage = 'Gagal memuat data anime. Silakan coba lagi.';
}
---

<Layout 
  title="Top Anime - AnimeYuk"
  description="Discover the highest-rated and most popular anime series of all time"
>
  <div class="mx-auto mb-12 max-w-3xl text-center">
    
    <h1 class="mb-4 text-4xl font-extrabold tracking-tight text-gray-900 dark:text-white md:text-5xl">
      Top Rated Anime
    </h1>
    
    <p class="text-lg text-gray-600 dark:text-gray-400">
      Daftar anime legendaris dengan rating tertinggi sepanjang masa pilihan komunitas global.
    </p>
  </div>

  {errorMessage ? (
    <div class="mx-auto max-w-lg rounded-xl border border-red-200 bg-red-50 p-6 text-center text-red-600 dark:border-red-900/50 dark:bg-red-900/20 dark:text-red-400">
      <div class="mb-2 text-3xl">⚠️</div>
      <p class="font-medium">{errorMessage}</p>
    </div>
  ) : topAnimeResponse && (
    <>
      <AnimeList animes={topAnimeResponse.data} />
      
      <div class="mt-12 flex justify-center">
        {topAnimeResponse.pagination && (
          <Pagination
            client:only="react"
            currentPage={topAnimeResponse.pagination.current_page}
            lastPage={topAnimeResponse.pagination.last_visible_page}
            hasNextPage={topAnimeResponse.pagination.has_next_page}
            baseUrl="/anime/top"
          />
        )}
      </div>
    </>
  )}
</Layout>