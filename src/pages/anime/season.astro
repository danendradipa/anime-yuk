---
export const prerender = false;
import Layout from '../../layouts/Layout.astro';
import AnimeList from '../../components/common/AnimeList.astro';
import Pagination from '../../components/react/Pagination';
import { getCurrentSeasonAnime } from '../../api/animeApi';

const page = parseInt(Astro.url.searchParams.get('page') || '1');

let seasonAnimeResponse;
let errorMessage = '';

try {
  seasonAnimeResponse = await getCurrentSeasonAnime(page, 25);
} catch (error) {
  console.error('Error fetching season anime:', error);
  errorMessage = 'Gagal memuat data anime. Silakan coba lagi.';
}
---

<Layout 
  title="Current Season Anime - AnimeYuk"
  description="Discover what's airing this season"
>
  <div class="mx-auto mb-12 max-w-3xl text-center">

    <h1 class="mb-4 text-4xl font-extrabold tracking-tight text-gray-900 dark:text-white md:text-5xl">
      Current Season
    </h1>
    
    <p class="text-lg text-gray-600 dark:text-gray-400">
      Jangan lewatkan episode terbaru dari anime yang sedang tayang musim ini.
    </p>
  </div>

  {errorMessage ? (
    <div class="mx-auto max-w-lg rounded-xl border border-red-200 bg-red-50 p-6 text-center text-red-600 dark:border-red-900/50 dark:bg-red-900/20 dark:text-red-400">
      <div class="mb-2 text-3xl">⚠️</div>
      <p class="font-medium">{errorMessage}</p>
    </div>
  ) : seasonAnimeResponse && (
    <>
      <AnimeList animes={seasonAnimeResponse.data} />
      
      <div class="mt-12 flex justify-center">
        {seasonAnimeResponse.pagination && (
          <Pagination
            client:only="react"
            currentPage={seasonAnimeResponse.pagination.current_page}
            lastPage={seasonAnimeResponse.pagination.last_visible_page}
            hasNextPage={seasonAnimeResponse.pagination.has_next_page}
            baseUrl="/anime/season"
          />
        )}
      </div>
    </>
  )}
</Layout>